<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:jsf="http://xmlns.jcp.org/jsf">

    <p:dialog id="dial-modal" 
              closeOnEscape="true" 
              widgetVar="modalDlg"
              modal="true"
              header="#{contableRptFiduciaJSF.contableRptFiducia.idContableRptFiducia != null ? 'EDITAR REPORTE FIDUCIA' : 'NUEVA REPORTE FIDUCIA'}"
              resizable="false" 
              class="mr1024_60 mr500_90"
              fitViewport="true"
              appendTo="@(body)" 
              position="center top"
              responsive="true">
        <h:form id="form-modal">
            <div class="ui-fluid">
                <p:messages id="messages" showDetail="true" closable="true">
                    <p:effect type="pulsate" event="load" delay="500" />
                </p:messages>
                <div class="ui-g Padding0">
                    <div class="ui-g-12 ui-md-12 ui-lg-12 Padding0">
                        <div class="ui-g-12 ui-md-12 ui-lg-6 Padding5">
                            <div class="ui-g-12 ui-md-12 ui-lg-12 Padding0">
                                <h:outputText value="Desde *"/>
                            </div>
                            <div class="ui-g-12 ui-md-12 ui-lg-12 Padding0">
                                <p:calendar id="desde" 
                                            value="#{contableRptFiduciaJSF.contableRptFiducia.desde}" 
                                            pattern="yyyy-MM-dd" 
                                            navigator="true"
                                            title="Desde"
                                            mask="true"
                                            locale="es"
                                            showOn="button"
                                            required="true"
                                            requiredMessage="Desde es requerido"/>
                            </div>
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-6 Padding5">
                            <div class="ui-g-12 ui-md-12 ui-lg-12 Padding0">
                                <h:outputText value="Hasta *"/>
                            </div>
                            <div class="ui-g-12 ui-md-12 ui-lg-12 Padding0">
                                <p:calendar id="hasta" 
                                            value="#{contableRptFiduciaJSF.contableRptFiducia.hasta}" 
                                            pattern="yyyy-MM-dd" 
                                            navigator="true"
                                            title="Desde"
                                            mask="true"
                                            locale="es"
                                            showOn="button"
                                            required="true"
                                            requiredMessage="Hasta es requerido"/>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6 Padding5">
                        <div class="ui-g-12 ui-md-12 ui-lg-12 Padding0">
                            <h:outputText value="Ingresos #{bundle.tipo_vehiculo_i}*"/>
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-12 Padding0">
                            <p:inputText id="ingresosArt" 
                                         value="#{contableRptFiduciaJSF.contableRptFiducia.ingresosArt}"
                                         maxlength="15"
                                         class="cssGreenColor"
                                         placeholder="$"
                                         required="true" 
                                         requiredMessage="Ingresos #{bundle.tipo_vehiculo_i} es requerido" >
                                <p:keyFilter regEx="/[.0-9]/i"/>  
                            </p:inputText>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6 Padding5">
                        <div class="ui-g-12 ui-md-12 ui-lg-12 Padding0">
                            <h:outputText value="Egresos #{bundle.tipo_vehiculo_i}*"/>
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-12 Padding0">
                            <p:inputText id="egresosArt" 
                                         value="#{contableRptFiduciaJSF.contableRptFiducia.egresosArt}"
                                         maxlength="15"
                                         class="cssRedColor"
                                         placeholder="$"
                                         required="true" 
                                         requiredMessage="Egresos #{bundle.tipo_vehiculo_i} es requerido" >
                                <p:keyFilter regEx="/[.0-9]/i"/>  
                            </p:inputText>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6 Padding5">
                        <div class="ui-g-12 ui-md-12 ui-lg-12 Padding0">
                            <h:outputText value="Ingresos #{bundle.tipo_vehiculo_ii}*"/>
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-12 Padding0">
                            <p:inputText id="ingresosBi" 
                                         value="#{contableRptFiduciaJSF.contableRptFiducia.ingresosBi}"
                                         maxlength="15"
                                         class="cssGreenColor"
                                         placeholder="$"
                                         required="true" 
                                         requiredMessage="Ingresos #{bundle.tipo_vehiculo_ii} es requerido" >
                                <p:keyFilter regEx="/[.0-9]/i"/>  
                            </p:inputText>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6 Padding5">
                        <div class="ui-g-12 ui-md-12 ui-lg-12 Padding0">
                            <h:outputText value="Egresos #{bundle.tipo_vehiculo_ii}*"/>
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-12 Padding0">
                            <p:inputText id="egresosBi" 
                                         value="#{contableRptFiduciaJSF.contableRptFiducia.egresosBi}"
                                         maxlength="15"
                                         class="cssRedColor"
                                         placeholder="$"
                                         required="true" 
                                         requiredMessage="Egresos #{bundle.tipo_vehiculo_ii} es requerido" >
                                <p:keyFilter regEx="/[.0-9]/i"/>  
                            </p:inputText>
                        </div>
                    </div>
                </div>
                <div class="ui-g Padding5">
                    <div class="ui-g-12 ui-md-12 ui-lg-12 Padding0">
                        <h:outputText value="Observación *"/>
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-12 Padding0">
                        <p:inputTextarea id="observacion"
                                         maxlength="255"
                                         required="true"
                                         requiredMessage="Observación es requerido"
                                         value="#{contableRptFiduciaJSF.contableRptFiducia.observacion}"/>
                    </div>
                </div>
                <div class="ui-g Padding5">
                    <p:accordionPanel id="detalles" style="width: 98% !important;">
                        <p:tab id="det" title="Detalle Reporte Fiducia">
                            <p:dataTable id="tbl-det"
                                         value="#{contableRptFiduciaJSF.listContableRptFiduciaDet}"
                                         var="dett"
                                         rowIndexVar="indexDest"
                                         rows="5"
                                         rowsPerPageTemplate="5,10,20"
                                         paginator="true"
                                         reflow="true"
                                         scrollable="true"
                                         scrollHeight="500">

                                <f:facet name="paginatorTopRight">
                                    <p:commandButton id="nuevo-det"
                                                     oncomplete="PF('modalDetDlg').show()"
                                                     actionListener="#{contableRptFiduciaJSF.nuevoContRptFidDet()}"
                                                     update=":dial-modal-det"
                                                     process="@this"
                                                     value="Nuevo"
                                                     class="cssWhite"
                                                     icon="fa fa-plus" />
                                </f:facet>
                                <p:column headerText="#" style="width: 20px">
                                    <p:outputLabel value="#{indexDest + 1}" />
                                </p:column>
                                <p:column headerText="Num Cuenta">
                                    <p:outputLabel value="#{dett.idContableCta.nroCuenta}" title="#{dett.idContableCta.nroCuenta}" />
                                </p:column>
                                <p:column headerText="Tipo Cuenta">
                                    <p:outputLabel value="#{dett.idContableCta.idContableCtaTipo.tipoCuenta}" />
                                </p:column>
                                <p:column headerText="Concepto">
                                    <p:outputLabel value="#{dett.idContableCta.concepto}" title="#{dett.idContableCta.descripcion}" />
                                </p:column>
                                <p:column headerText="Multa"
                                          styleClass="#{dett.idContableCta.esMulta == 1 ? 'cssGreen' : 'cssRed'}">
                                    <h:outputText value="Sí" rendered="#{dett.idContableCta.esMulta == 1}" styleClass="cssWhite"/>
                                    <h:outputText value="No" rendered="#{dett.idContableCta.esMulta == 0}" styleClass="cssWhite"/>
                                </p:column>
                                <p:column headerText="Valor">
                                    <p:outputLabel value="#{dett.valor}" title="#{dett.observacion}" >
                                        <f:convertNumber pattern="$#,###.###" currencySymbol="$" type="currency"/>
                                    </p:outputLabel>
                                </p:column>
                                <p:column headerText="Acciones">
                                    <div class="ui-g Padding0">
                                        <div class="ui-g-6 ui-md-6 ui-lg-6 Padding0" style="text-align: center">
                                            <p:commandButton id="det-editar"
                                                             title="Editar"
                                                             actionListener="#{contableRptFiduciaJSF.prepareEditarContRptFidDet(dett)}"
                                                             process="@this"
                                                             oncomplete="PF('modalDetDlg').show()"
                                                             update=":dial-modal-det"
                                                             class="cssWhite OrangeButton"
                                                             icon="fa fa-pencil" />
                                        </div>
                                        <div class="ui-g-6 ui-md-6 ui-lg-6 Padding0" style="text-align: center">
                                            <p:commandButton id="det-eliminar"
                                                             process="@this"
                                                             update=":form-modal:detalles:tbl-det,:form:msg"
                                                             actionListener="#{contableRptFiduciaJSF.onEliminarContRptFidDet(dett)}"
                                                             title="Eliminar"
                                                             class="cssWhite RedButton"
                                                             icon="fa fa-trash" >
                                                <p:confirm header="Confirmación" message="Seguro de eliminar detalle reporte fiducia?" 
                                                           icon="fa fa-exclamation-triangle" />
                                            </p:commandButton>
                                        </div>
                                    </div>
                                </p:column>
                            </p:dataTable>
                        </p:tab>
                        <p:tab id="dist" title="Distribución Kilómetros">
                            <p:tabView id="tbvDist">
                                <p:tab title="Distribución" id="tbDist">
                                    <p:dataTable id="tbl-dist"
                                                 value="#{contableRptFiduciaJSF.listContableRptFiduciaDist}"
                                                 var="dist"
                                                 rowIndexVar="indexDist"
                                                 rows="5"
                                                 rowsPerPageTemplate="5,10,20"
                                                 paginator="true"
                                                 reflow="true"
                                                 scrollable="true"
                                                 scrollHeight="500">

                                        <f:facet name="paginatorTopRight">
                                            <p:commandButton id="simular"
                                                             actionListener="#{contableRptFiduciaJSF.distribuirKmVehiculos()}"
                                                             update="@form"
                                                             process="@this,@form"
                                                             value="Simular"
                                                             class="cssWhite"
                                                             icon="fa fa-check" />
                                        </f:facet>
                                        <p:column headerText="#" style="width: 20px">
                                            <p:outputLabel value="#{indexDist + 1}" />
                                        </p:column>
                                        <p:column headerText="Num Cuenta">
                                            <p:outputLabel value="#{dist.idContableCtaVehiculo.nroCta}" />
                                        </p:column>
                                        <p:column headerText="Vehículo">
                                            <p:outputLabel value="#{dist.idContableCtaVehiculo.idVehiculo.codigo}" />
                                        </p:column>
                                        <p:column headerText="Tipo" groupRow="true">
                                            <p:outputLabel value="#{dist.idContableCtaVehiculo.idVehiculo.idVehiculoTipo.nombreTipoVehiculo}" />
                                        </p:column>
                                        <p:column headerText="Kilómetro calculado">
                                            <p:outputLabel value="#{dist.kmAplicado}" />
                                        </p:column>
                                        <p:column headerText="Valor">
                                            <p:outputLabel value="#{dist.valor}" >
                                                <f:convertNumber pattern="#,###.###" currencySymbol="$" type="currency"/>
                                            </p:outputLabel>
                                        </p:column>
                                        <p:columnGroup type="footer">
                                            <p:row>
                                                <p:column colspan="3" style="text-align:right" footerText="" />
                                                <p:column footerText="#{bundle.tipo_vehiculo_i}" />
                                                <p:column footerText="#{bundle.tipo_vehiculo_ii}" />
                                            </p:row>
                                            <p:row>
                                                <p:column colspan="3" style="text-align:right" footerText="Total (Km):" />
                                                <p:column footerText="#{contableRptFiduciaJSF.kmetrosArt}" />
                                                <p:column footerText="#{contableRptFiduciaJSF.kmetrosBi}" />
                                            </p:row>
                                            <p:row>
                                                <p:column colspan="3" style="text-align:right" footerText="Total ($):" />
                                                <p:column>
                                                    <f:facet name="footer">
                                                        <h:outputText value="#{contableRptFiduciaJSF.vlTotalArt}">
                                                            <f:convertNumber type="currency" currencySymbol="$" />
                                                        </h:outputText>
                                                    </f:facet>
                                                </p:column>
                                                <p:column>
                                                    <f:facet name="footer">
                                                        <h:outputText value="#{contableRptFiduciaJSF.vlTotalBi}">
                                                            <f:convertNumber type="currency" currencySymbol="$" />
                                                        </h:outputText>
                                                    </f:facet>
                                                </p:column>
                                            </p:row>
                                        </p:columnGroup>
                                        <f:facet name="footer">
                                            <h:commandLink>
                                                <img src="../../resources/img/excel.png" title="Exportar en formato Excel"
                                                     alt="excel" style="width: 24px;height: 24px"/>
                                                <p:dataExporter type="xlsx" target="tbl-dist" fileName="distribucion #{now}" />
                                            </h:commandLink>
                                        </f:facet>
                                    </p:dataTable>
                                </p:tab>
                                <p:tab title="Errores" id="tbErrores">
                                    <p:dataTable id="tbError"
                                                 var="error" 
                                                 value="#{contableRptFiduciaJSF.listErrores}"
                                                 rows="5"
                                                 rowsPerPageTemplate="5,10,20"
                                                 paginator="true">
                                        <p:column headerText="Errores">
                                            <h:outputText value="#{error}" />
                                        </p:column>
                                        <f:facet name="footer">
                                            <h:commandLink>
                                                <img src="../../resources/img/excel.png" title="Exportar en formato Excel"
                                                     alt="excel" style="width: 24px;height: 24px"/>
                                                <p:dataExporter type="xlsx" target="tbError" fileName="errores distribucion #{now}" />
                                            </h:commandLink>
                                        </f:facet>
                                    </p:dataTable>
                                </p:tab>
                            </p:tabView>
                        </p:tab>
                    </p:accordionPanel>
                </div>
            </div>
            <p:remoteCommand name="guardarRf" 
                             class="cssWhite"
                             actionListener="#{contableRptFiduciaJSF.guardar()}"
                             update=":form,@form"
                             rendered="#{empty contableRptFiduciaJSF.contableRptFiducia.idContableRptFiducia}"
                             process="@form" />
            <p:remoteCommand name="editarRf" 
                             class="cssWhite"
                             actionListener="#{contableRptFiduciaJSF.actualizar()}"
                             update=":form"
                             rendered="#{not empty contableRptFiduciaJSF.contableRptFiducia.idContableRptFiducia}"
                             process="@this,@form" />
        </h:form>
        <f:facet name="footer">
            <p:commandButton id="btn-guardar"
                             value="Guardar"
                             rendered="#{empty contableRptFiduciaJSF.contableRptFiducia.idContableRptFiducia}"
                             class="cssWhite"
                             icon="fa fa-check"
                             onclick="guardarRf()"/>
            <p:commandButton id="btn-editar"
                             value="Actualizar"
                             rendered="#{not empty contableRptFiduciaJSF.contableRptFiducia.idContableRptFiducia}"
                             class="cssWhite"
                             icon="fa fa-check"
                             onclick="editarRf()"/>
        </f:facet>
    </p:dialog>
</ui:composition>